{% extends "scrclubCMSBundle:cms:layout.html.twig" %}



{% block body %}



<div class="container">

    <ul class="breadcrumb">
        <li><a href="{{  path('scrclub_cms_homepage')}}">Home</a> <span class="divider">/</span></li>
        {% if node.parent  %}{% include 'scrclubCMSBundle:cms:node_nav.html.twig' with {'node':node.parent, 'level':0 } %}{% endif %}
    </ul>

   

    <div class="featurette">
        <h2 class="featurette-heading">{{ 'section'| trans | capitalize }} {{ nodeParent.name }}</h2>
        <div class="muted featurette-sub-heading">{{tree | length}} {{ 'post'| trans  }}</div>
    </div>

    <hr class="featurette-divider">



    {% if form.get('errors') is not empty %}
    <div class="row-fluid page-header">
        <div class="featurette">
            <div class="alert alert-error">
                <button type="button" class="close" data-dismiss="alert">&times;</button>
                <strong>Error!</strong> {{form_errors(form)}}
            </div>
        </div>
    </div>
    {% endif %}

    <hr class="featurette-divider">

    <div class="row-fluid page-header">
        <div class="featurette">
            <a href="{{path('scrclub_cms_addpost', { 'parent_id': nodeParent.id })}}" ><button class="btn btn-large pull-right" type="button"><i class="icon-plus"></i> {% trans %}add{% endtrans %} {% trans %}post{% endtrans %}</button></a>
        </div>
    </div>
    <div id="alert-area"></div>



    {% include 'scrclubCMSBundle:cms:nodeChildren.html.twig' with {'tree':tree, 'level':0 } %}

    <hr>




</div>
<!-- /container -->



<script>

    $(document).ready(function () {




        $('.sortable').nestedSortable({

            handle              :   'div',
            helper              :   'clone',
            items               :   'li',
            rootID              :   {{ nodeParent.id }},
            opacity             :   1,
            tolerance           :   'pointer',
            placeholder         :   "placeholder",
            forcePlaceholderSize:   true,
            protectRoot         : true,

            update              :   function (event, ui) {

                                    var arraied = $('.sortable').nestedSortable('toArray', {startDepthCount:0});
                                        $.ajax({
                                            type :'post',
                                            cache:false,
                                            url  :'{{ path('scrclub_cms_editnodetree') }}',
                                            data :{data:arraied},
                                            success: function(data){
                                            }
                                        });


                                    }

        });




    });



    jQuery('.submenu').hover(function () {
        jQuery(this).children('ul').removeClass('submenu-hide').addClass('submenu-show');
    },function () {
        jQuery(this).children('ul').removeClass('.submenu-show').addClass('submenu-hide');
    }).find("a:first").append(" &raquo; ");


    $(function () {

        $('.delete_node' ).each(function() {

            $(this).click(function () {

                var li = $($(this).parents().get()[4]);
                var id = li.attr('id').slice(5);



                bootbox.confirm("{{ 'wannado.this' | trans }}", function(result) {

                    if (result) {
                        $.ajax({
                            type :'post',
                            cache:false,
                            url  :'{{ path('scrclub_cms_deletenode')}}',
                            data :{data:id},
                            success: function(data){
                                newAlert("success", "{{ 'delete.success' | trans }}");
                                li.remove();
                            }
                        });
                    }
                });
            })
        });

        $('.switch-active' ).each(function() {

            $(this).on('switch-change', function (e, data) {

                var li = $($(this).parents().get()[1]);
                var id = li.attr('id').slice(5);

                var result = {
                    id : id,
                    active:data.value
                }

                $.ajax({
                    type :'post',
                    cache:false,
                    url  :'{{ path('scrclub_cms_updateActiveNode')}}',
                    data :result,
                    success: function(data){

                        console.log(data);

                        //newAlert("success", "{{ 'update.success' | trans }}");
                    }
                });
            })
        });

    })

</script>




</script>



{% endblock %}